// ConsoleApplication1.cpp : Defines the entry point for the console application.
//

#include "stdafx.h"
#include <iostream>
#include <fstream>
#include <string>
#include <iomanip>
#include <algorithm>

#define FNAME1 "data.dat"
#define FNAME2 "результат.txt"

using namespace std;

int main()
{
	setlocale(0, "");
	//Подключаем файл для записи
	ifstream myFile(FNAME1);
	string str;
	if (myFile.is_open())
	{
		cout << "Файл успешно открыт. Он содержит: " << endl << endl;
		string fileContents;

		while (myFile.good())
		{
			getline(myFile, fileContents);
			str += fileContents;
			cout << fileContents << endl;
		}
		myFile.close();
	}
	else
	{
		cout << "open(): ошибка открытия файла" << endl;
	}
	cout << endl;
	system("pause");

	// Удалене повторющихся пробелов
	auto newEnd = unique(str.begin(), str.end(), [](char l, char r) {return (l == r); });
	str.erase(newEnd, str.end());

	//Добавление красных строк

	/*size_t pos = str.find("! " || ". " || "? ", 0);
	while (pos != string::npos)
	{
		str.insert(pos + 2, "\n");
		size_t searchOffSet = pos + 1;
		pos = str.find("! " || ". " || "? ", searchOffSet);
	}*/
	size_t pos = str.find(".", 0);
	while (pos != string::npos)
	{
		str.insert(pos + 2, "\n");
		size_t searchOffSet = pos + 1;
		pos = str.find(". ", searchOffSet);
	}

	size_t pos2 = str.find("!", 0);
	while (pos2 != string::npos)
	{
		str.insert(pos2 + 2, "\n");
		size_t searchOffSet = pos2 + 1;
		pos2 = str.find("! ", searchOffSet);
	}

	size_t pos3 = str.find("?", 0);
	while (pos3 != string::npos)
	{
		str.insert(pos3 + 2, "\n");
		size_t searchOffSet = pos3 + 1;
		pos3 = str.find("? ", searchOffSet);
	}

	//Запись полученного текста в файл результат.txt
	ofstream myFile2(FNAME2);
	myFile2 << "Полученный текст:" << endl << endl;
	myFile2 << str << endl;
	myFile2.close();

	//Вывод полученного текста на экран
	cout << endl << "Полученный текст:" << endl << str << endl << endl;
	system("pause");
	return 0;
}
